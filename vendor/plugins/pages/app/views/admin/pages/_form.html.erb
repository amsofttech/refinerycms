<% content_for :head_after_javascript_libraries do %>
  <script language="javascript">
    var locale = "<%= I18n.locale %>";
  </script>
<% end %>

<%= error_messages_for :page %>

<% form_for [:admin, @page] do |f| %>
  <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title, :class => "larger", :style => 'width: 954px' %>
  </div>
  <div id="page-tabs" class="clearfix">
    <ul id="page_parts">
    <% @page.parts.each_with_index do |part, part_index| %>
      <li>
        <%= link_to part.title, "#" << (@page.new_record? ? "page_part_new_#{part_index}" : part.to_param) %>
      </li>
    <% end %>
    </ul>
    <% if RefinerySetting.find_or_set(:new_page_parts, false) %>
      <ul id="page_parts_controls">
        <li>
          <%= link_to refinery_icon_tag("add.png"), "#", :id => "add_page_part", :title => t('.create_content_section') %>
        </li>
        <li>
          <%= link_to(refinery_icon_tag("delete.png"), "#", :title => t('.delete_content_section'), :class => 'delete_page_part', :name => t('.delete_content_section'), :id => "delete_page_part") %>
        </li>
      </ul>
    <% end %>

    <div id='page_part_editors'>
      <% part_index = -1 %>
      <% f.fields_for :parts do |p| %>
        <%= render :partial => "page_part_field", :locals => {
          :part => p.object,
          :part_index => (part_index += 1),
          :new_part => @page.new_record?
        } %>
      <% end %>
    </div>
  </div>
  <p>
    <%# TODO Translate :rel %>
    <%= link_to "&raquo;" + t('.hide_or_show_advanced_options'), "#", :id => "toggle_advanced_options",
          :rel => "Click to access meta tag settings and menu options" %>
  </p>
  <div id='more_options' style="display:none;">
    <div class='field'>
      <%= f.label :parent_id %>
      <%= f.collection_select :parent_id, @pages_for_parents_list, :id, :indented_title, :include_blank => true %>
    </div>
    <div class='field'>
      <%= label_tag :custom_title %>
      <%= label_tag "", t('.title_type'), :class => "stripped" %>
      <% ["none", "text", "image"].each do |type| %>
        <%= f.radio_button :custom_title_type, "#{type}" %>
        <%= label_tag "page_custom_title_type_#{type}", t(".title_types.#{type}").titleize, :class => "stripped" %>
      <% end %>
      <br/>
      <div id='custom_title_none'></div>
      <div id='custom_title_text' style='display: <%= @page.custom_title_type == 'text' ? 'block' : 'none' %>'>
        <p>
          <%= f.text_field :custom_title, {:size => 103} %><br/>
          <small>
            <%=t('.explain_page_different_title')%>
            <br/>
          </small>
        </p>
      </div>
    </div>
    <div class='field'>
      <%= label_tag :skip_to_first_child?, t('activerecord.attributes.page.skip_to_first_child') %>
      <%= f.check_box :skip_to_first_child %>
      <%= f.label :skip_to_first_child, t('.redirect_to_first_child'), :class => "stripped" %>
    </div>
    <div class='field'>
      <%= f.label :link_url, t('.custom_url') %>
      <%= f.text_field :link_url, {:size => 103} %><br/>
      <small>
        <%= t('.custom_url_explanation') %>
      </small>
    </div>
    <h2><%= t('.seo') %></h2>
    <div class='field'>
      <%= f.label :browser_title %>
      <%= f.text_field :browser_title, :size => 63 %><br/>
      <small>
        <%= t('.seo_override_title') %>
      </small>
    </div>
    <div class='field'>
      <%= f.label :meta_keywords %>
      <%= f.text_field :meta_keywords, :size => 63 %><br/>
      <small>
        <%= t('.meta_keywords') %>
              </small>
    </div>
    <div class='field'>
      <%= f.label :meta_description %>
      <%= f.text_area :meta_description, :cols => 95, :rows => 3 %><br/>
      <small>
        <%= t('.meta_description') %>
      </small>
    </div>
    <div class='field'>
      <%= f.label :show_in_menu %>
      <%= f.check_box :show_in_menu %>
      <small>
        <%= f.label :show_in_menu, t('.show_in_menu_description')  %>
      </small>
    </div>
  </div>
  <div class='field'>
    <label><%= t('.draft') %></label>
    <%= f.check_box :draft %>
    <%= f.label :draft, t('.save_as_draft'),  :class => "stripped" %>
  </div>
  <%= render :partial => "/shared/admin/form_actions", :locals => {:f => f, :continue_editing => true} %>
  <% if RefinerySetting.find_or_set(:new_page_parts, false) %>
    <div id='new_page_part_dialog' style='display: none'>
      <div class='field'>
        <%# TODO Translate %>
        <label for='new_page_part_title'>Title</label>
        <input id='new_page_part_title' value='' class='larger' size='40' />
        <input id='new_page_part_index' type='hidden' value='<%= @page.parts.size %>' />
      </div>
      <%= render :partial => "/shared/admin/form_actions", :locals => {
        :f => f,
        :continue_editing => false,
        :submit_button_id => "new_page_part_save",
        :cancel_button_id => "new_page_part_cancel"
      } %>
    </div>
  <% end %>
<% end %>

<% content_for :head do %>
<script type='text/javascript'>
  $(document).ready(function(){
    var page_parts = <%= RefinerySetting.find_or_set(:new_page_parts, false) == true ? 'true' : 'false' %>;
    var new_part_url = "<%= new_admin_page_part_url %>";
    var del_part_url = "<%= admin_page_parts_url %>";
    page_options.init(page_parts, new_part_url, del_part_url);
  });
</script>
<% end %>
